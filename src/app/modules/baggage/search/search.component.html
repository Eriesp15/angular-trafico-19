<div class="search-container">
  <app-breadcrumb [items]="breadcrumbItems"></app-breadcrumb>

  <div class="search-header">
    <h1>
      <mat-icon class="header-icon">luggage</mat-icon>
      Buscar Equipaje
    </h1>
    <p class="subtitle">Rastree equipajes por BagTag o busque por contenido - Similar a World Tracer</p>
  </div>

  <div class="search-layout">
    <!-- Search Options Panel -->
    <div class="search-options">
      <div class="option-card" [class.active]="activeTab === 0">
        <button (click)="switchTab(0)" class="option-btn">
          <mat-icon>local_shipping</mat-icon>
          <span>Buscar por BagTag</span>
        </button>
      </div>

      <div class="option-card" [class.active]="activeTab === 1">
        <button (click)="switchTab(1)" class="option-btn">
          <mat-icon>description</mat-icon>
          <span>Buscar por Contenido</span>
        </button>
      </div>
    </div>

    <!-- Search Input Panel -->
    <div class="search-forms">
      <!-- Tab 1: Buscar por BagTag -->
      <div class="search-form" *ngIf="activeTab === 0" [@fadeInOut]>
        <mat-card class="form-card">
          <mat-card-header>
            <mat-card-title>Buscar por Código BagTag</mat-card-title>
            <mat-card-subtitle>Ingrese el código de seguimiento del equipaje</mat-card-subtitle>
          </mat-card-header>

          <mat-card-content>
            <form [formGroup]="searchByBagTagForm" (ngSubmit)="searchByBagTag()">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Código BagTag</mat-label>
                <input
                  matInput
                  formControlName="bagTag"
                  placeholder="Ej: BOA234567"
                  type="text"
                  (keyup.enter)="searchByBagTag()"
                />
                <mat-icon matPrefix>label</mat-icon>
              </mat-form-field>

              <button
                mat-raised-button
                color="primary"
                type="submit"
                [disabled]="searchByBagTagForm.invalid || isSearching"
                class="search-btn"
              >
                <mat-icon>search</mat-icon>
                Buscar Equipaje
              </button>
            </form>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Tab 2: Buscar por Contenido -->
      <div class="search-form" *ngIf="activeTab === 1" [@fadeInOut]>
        <mat-card class="form-card">
          <mat-card-header>
            <mat-card-title>Buscar por Contenido</mat-card-title>
            <mat-card-subtitle>Describa el contenido o características del equipaje</mat-card-subtitle>
          </mat-card-header>

          <mat-card-content>
            <form [formGroup]="searchByContentForm" (ngSubmit)="searchByContent()">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Descripción del contenido</mat-label>
                <textarea
                  matInput
                  formControlName="description"
                  placeholder="Ej: Maleta negra, ropa, computadora..."
                  rows="4"
                ></textarea>
                <mat-icon matPrefix>description</mat-icon>
              </mat-form-field>

              <button
                mat-raised-button
                color="primary"
                type="submit"
                [disabled]="searchByContentForm.invalid || isSearching"
                class="search-btn"
              >
                <mat-icon>search</mat-icon>
                Buscar Equipaje
              </button>
            </form>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </div>

  <!-- Search Results -->
  <div class="results-section" *ngIf="searchResults.length > 0 || isSearching || noResults">
    <div class="results-header">
      <h2>
        <mat-icon>list_alt</mat-icon>
        Resultados de la Búsqueda
      </h2>
      <button
        mat-icon-button
        (click)="clearResults()"
        *ngIf="searchResults.length > 0 && !isSearching"
        class="clear-btn"
        matTooltip="Limpiar resultados"
      >
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <!-- Loading State -->
    <div class="loading-container" *ngIf="isSearching">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Buscando equipaje en la base de datos...</p>
    </div>

    <!-- Results List -->
    <div class="results-list" *ngIf="!isSearching && searchResults.length > 0">
      <div class="result-item" *ngFor="let result of searchResults">
        <div class="result-top">
          <div class="pir-badge">
            <span class="label">PIR</span>
            <span class="value">{{ result.pirNumber }}</span>
          </div>
          <span class="status-badge" [ngClass]="getStatusClass(result.status)">
            {{ getStatusLabel(result.status) }}
          </span>
          <span class="type-badge">
            {{ getTipoLabel(result.claimType) }}
          </span>
        </div>

        <div class="result-details">
          <div class="detail-row">
            <div class="detail-item">
              <label>Pasajero</label>
              <p>{{ result.passengerName }}</p>
            </div>
            <div class="detail-item" *ngIf="result.bagtag">
              <label>BagTag</label>
              <p>{{ result.bagtag }}</p>
            </div>
            <div class="detail-item">
              <label>Fecha</label>
              <p>{{ result.createdAt | date: "short" }}</p>
            </div>
          </div>

          <div class="detail-row" *ngIf="result.content">
            <div class="detail-item full-width">
              <label>Contenido</label>
              <p>{{ result.content }}</p>
            </div>
          </div>
        </div>

        <div class="result-actions">
          <button
            mat-raised-button
            color="primary"
            (click)="viewClaim(result.pirNumber)"
            class="view-btn"
          >
            <mat-icon>visibility</mat-icon>
            Ver Reclamo
          </button>
        </div>
      </div>
    </div>

    <!-- No Results State -->
    <div class="empty-state" *ngIf="!isSearching && noResults">
      <mat-icon class="empty-icon">search_off</mat-icon>
      <h3>Sin resultados</h3>
      <p>No se encontró equipaje con los criterios de búsqueda. Intente con otros términos.</p>
    </div>
  </div>

  <!-- Initial Empty State -->
  <div class="initial-state" *ngIf="searchResults.length === 0 && !isSearching && !noResults">
    <mat-card class="info-card">
      <mat-card-content>
        <mat-icon class="initial-icon">travel_explore</mat-icon>
        <h3>Inicie su búsqueda</h3>
        <p>Use los campos de búsqueda arriba para encontrar equipaje por BagTag o por contenido.</p>
        <p class="hint">Puede buscar equipaje individual o explorar múltiples reclamos simultáneamente.</p>
      </mat-card-content>
    </mat-card>
  </div>
</div>
