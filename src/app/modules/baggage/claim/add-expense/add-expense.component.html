<div class="add-expense-container">
  <div class="expense-card">
    <!-- Header -->
    <div class="expense-header">
      <h1>Añadir Gasto</h1>
      <p class="subtitle">Reclamo #{{ claimId }}</p>
      <!-- Mostrar tipo de reclamo con su color -->
      <div class="claim-type-badge" [style.background-color]="getTipoReclamoInfo().color">
        {{ getTipoReclamoInfo().nombre }}
      </div>
    </div>

    <!-- Mensaje informativo sobre gastos permitidos -->
    <div class="info-banner" *ngIf="!gastoSeleccionado && !mostrarConfirmacion">
      <mat-icon>info</mat-icon>
      <span>Los gastos disponibles se filtran según el tipo de reclamo <strong>{{ getTipoReclamoInfo().nombre }}</strong></span>
    </div>

    <!-- Selección de tipo de gasto -->
    <div class="tipo-gasto-section" *ngIf="!gastoSeleccionado && !mostrarConfirmacion">
      <h2>Seleccione el tipo de gasto</h2>
      
      <!-- Mostrar mensaje si no hay gastos disponibles -->
      <div class="empty-state" *ngIf="tiposGasto.length === 0">
        <mat-icon>block</mat-icon>
        <p>No hay gastos disponibles para este tipo de reclamo</p>
      </div>
      
      <div class="tipos-gasto-grid" *ngIf="tiposGasto.length > 0">
        <div 
          class="tipo-gasto-card" 
          *ngFor="let tipo of tiposGasto"
          [class.disabled]="!tipo.habilitado"
          [class.selected]="gastoSeleccionado?.id === tipo.id"
          (click)="seleccionarTipoGasto(tipo)"
        >
          <div class="tipo-icon">
            <mat-icon>{{ tipo.icon }}</mat-icon>
          </div>
          <div class="tipo-info">
            <h3>{{ tipo.nombre }}</h3>
            <p>{{ tipo.descripcion }}</p>
          </div>
          <div class="tipo-status" *ngIf="!tipo.habilitado">
            <span class="disabled-badge">No disponible</span>
          </div>
        </div>
      </div>

      <div class="actions">
        <button class="btn btn-cancel" (click)="cancelar()">
          <mat-icon>arrow_back</mat-icon>
          Volver
        </button>
      </div>
    </div>

    <!-- Formulario según tipo de gasto seleccionado -->
    <div class="formulario-gasto" *ngIf="gastoSeleccionado && !mostrarConfirmacion">
      <div class="form-header">
        <button class="btn-back" (click)="volverSeleccion()">
          <mat-icon>arrow_back</mat-icon>
        </button>
        <div class="selected-type">
          <mat-icon>{{ gastoSeleccionado.icon }}</mat-icon>
          <span>{{ gastoSeleccionado.nombre }}</span>
        </div>
      </div>

      <!-- Formulario para Indemnización (cálculo por peso) -->
      <div class="form-section" *ngIf="gastoSeleccionado.id === 'indemnizacion'">
        <p class="form-description">{{ gastoSeleccionado.descripcion }}</p>
        
        <!-- Mostrar información según tipo de reclamo -->
        <div class="calculation-info" *ngIf="tipoReclamo === 'PILFERED'">
          <mat-icon>info</mat-icon>
          <span>Según el manual MSA de BOA, la indemnización por contenido faltante es de <strong>15 USD por kilogramo</strong></span>
        </div>
        
        <div class="form-group">
          <label>Peso Registrado en Check-in (kg)</label>
          <input 
            type="number" 
            [(ngModel)]="pesoRecibido" 
            placeholder="Peso original del equipaje"
            (input)="calcularIndemnizacion()"
          />
        </div>

        <div class="form-group">
          <label>Peso Actual/Entregado (kg)</label>
          <input 
            type="number" 
            [(ngModel)]="pesoEntregado" 
            placeholder="Peso actual del equipaje"
            (input)="calcularIndemnizacion()"
          />
        </div>

        <div class="form-group">
          <label>Precio por Kilo (USD)</label>
          <input 
            type="number" 
            [(ngModel)]="precioPorKilo" 
            placeholder="15 USD según manual BOA"
            (input)="calcularIndemnizacion()"
          />
        </div>

        <div class="calculation-summary">
          <h3>Resumen del Cálculo</h3>
          <div class="summary-row">
            <span class="summary-label">Diferencia de peso:</span>
            <span class="summary-value">{{ diferenciaPeso.toFixed(2) }} kg</span>
          </div>
          <div class="summary-row">
            <span class="summary-label">Precio por kilo:</span>
            <span class="summary-value">${{ precioPorKilo || 0 }} USD</span>
          </div>
          <div class="total-row">
            <span class="total-label">Total a indemnizar</span>
            <span class="total-amount">${{ totalIndemnizar.toFixed(2) }} USD</span>
          </div>
        </div>
      </div>

      <!-- Formulario para Otro gasto -->
      <div class="form-section" *ngIf="gastoSeleccionado.id === 'otro'">
        <p class="form-description">Especifique el gasto personalizado</p>
        
        <div class="form-group">
          <label>Descripción del gasto</label>
          <textarea 
            [(ngModel)]="descripcionGasto" 
            placeholder="Describa el motivo del gasto"
            rows="3"
          ></textarea>
        </div>

        <div class="form-group">
          <label>Monto (USD)</label>
          <input 
            type="number" 
            [(ngModel)]="montoGasto" 
            placeholder="Ingrese el monto"
          />
        </div>
      </div>

      <!-- Formulario para gastos predefinidos -->
      <div class="form-section" *ngIf="gastoSeleccionado.id !== 'indemnizacion' && gastoSeleccionado.id !== 'otro'">
        <p class="form-description">{{ gastoSeleccionado.descripcion }}</p>
        
        <div class="form-group">
          <label>Monto (USD)</label>
          <input 
            type="number" 
            [(ngModel)]="montoGasto" 
            placeholder="Ingrese el monto del gasto"
          />
        </div>
      </div>

      <div class="actions">
        <button class="btn btn-cancel" (click)="cancelar()">
          Cancelar
        </button>
        <button 
          class="btn btn-accept" 
          [disabled]="!formularioValido()"
          (click)="aceptar()"
        >
          Aceptar
        </button>
      </div>
    </div>

    <!-- Confirmación -->
    <div class="confirmacion-section" *ngIf="mostrarConfirmacion">
      <div class="confirmacion-icon">
        <mat-icon>help_outline</mat-icon>
      </div>
      <h2>Confirmar Gasto</h2>
      <p class="confirmacion-mensaje">¿Está seguro de registrar el siguiente gasto?</p>

      <div class="confirmacion-detalle">
        <div class="detalle-row">
          <span class="detalle-label">Tipo de reclamo:</span>
          <span class="detalle-value">{{ getTipoReclamoInfo().nombre }}</span>
        </div>
        <div class="detalle-row">
          <span class="detalle-label">Tipo de gasto:</span>
          <span class="detalle-value">{{ gastoSeleccionado?.nombre }}</span>
        </div>
        <div class="detalle-row" *ngIf="gastoSeleccionado?.id === 'otro'">
          <span class="detalle-label">Descripción:</span>
          <span class="detalle-value">{{ descripcionGasto }}</span>
        </div>
        <div class="detalle-row" *ngIf="gastoSeleccionado?.id === 'indemnizacion'">
          <span class="detalle-label">Diferencia de peso:</span>
          <span class="detalle-value">{{ diferenciaPeso.toFixed(2) }} kg</span>
        </div>
        <div class="detalle-row total">
          <span class="detalle-label">Monto total:</span>
          <span class="detalle-value">${{ obtenerMontoTotal().toFixed(2) }} USD</span>
        </div>
      </div>

      <div class="actions">
        <button class="btn btn-cancel" (click)="cancelarConfirmacion()">
          <mat-icon>arrow_back</mat-icon>
          Volver
        </button>
        <button class="btn btn-confirm" (click)="confirmarGasto()">
          <mat-icon>check</mat-icon>
          Confirmar Gasto
        </button>
      </div>
    </div>
  </div>
</div>
