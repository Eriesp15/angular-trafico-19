<div class="list-container">
  <app-breadcrumb [items]="breadcrumbItems"></app-breadcrumb>
  <div class="list-header">
    <div class="header-top">
      
      <h1>Reclamos de Equipaje</h1>
      <div class="header-actions">
        <!-- Nuevo botón para crear OHL -->
        <button class="btn btn-secondary" (click)="createOHL()">
          <mat-icon>add_circle_outline</mat-icon>
          Equipaje Sobrante (OHL)
        </button>
        <button class="btn btn-primary" (click)="createNewClaim()">
          <mat-icon>add</mat-icon>
          Nuevo Reclamo
        </button>
      </div>
    </div>

    <!-- Búsqueda y Filtros -->
    <div class="search-filter-section">
      <form [formGroup]="searchForm" class="search-bar">
        <input
          type="text"
          formControlName="query"
          class="search-input"
          placeholder="Buscar por PIR, pasajero, vuelo, ruta, BagTag..."
        />
        <button type="button" class="btn-search" (click)="clearSearch()">
          Limpiar Todo
        </button>
        <button type="button" class="btn-filters" (click)="toggleFilters()" [class.active]="showFilters">
          <mat-icon>filter_list</mat-icon>
          Filtros
        </button>
      </form>

      <!-- Filtros Desplegables -->
      <div class="filter-group" [class.collapsed]="!showFilters">
        <!-- Filtro por Tipo de Reclamo actualizado con DPR y OHL -->
        <div class="filter-column">
          <label class="filter-label">Tipo de Reclamo:</label>
          <div class="filter-buttons">
            <button
              [class.active]="selectedType === 'ALL'"
              (click)="filterByType('ALL')"
              class="filter-btn"
            >
              Todos
            </button>
            <button
              [class.active]="selectedType === 'AHL'"
              (click)="filterByType('AHL')"
              class="filter-btn filter-ahl"
            >
              AHL
            </button>
            <button
              [class.active]="selectedType === 'DPR'"
              (click)="filterByType('DPR')"
              class="filter-btn filter-dpr"
            >
              DPR
            </button>
            <button
              [class.active]="selectedType === 'PILFERED'"
              (click)="filterByType('PILFERED')"
              class="filter-btn filter-pilfered"
            >
              PILFERED
            </button>
            <button
              [class.active]="selectedType === 'OHL'"
              (click)="filterByType('OHL')"
              class="filter-btn filter-ohl"
            >
              OHL
            </button>
          </div>
        </div>

        <!-- Nuevo filtro por Aeropuerto -->
        <div class="filter-column">
          <label class="filter-label">Aeropuerto:</label>
          <div class="filter-buttons filter-aeropuerto">
            <button
              [class.active]="selectedAeropuerto === 'ALL'"
              (click)="filterByAeropuerto('ALL')"
              class="filter-btn"
            >
              Todos
            </button>
            <button
              *ngFor="let aeropuerto of aeropuertos"
              [class.active]="selectedAeropuerto === aeropuerto.codigo"
              (click)="filterByAeropuerto(aeropuerto.codigo)"
              class="filter-btn"
              [title]="aeropuerto.nombre"
            >
              {{ aeropuerto.codigo }}
            </button>
          </div>
        </div>

        <!-- Filtro por Estado -->
        <div class="filter-column">
          <label class="filter-label">Estado:</label>
          <div class="filter-buttons">
            <button
              [class.active]="selectedStatus === 'ALL'"
              (click)="filterByStatus('ALL')"
              class="filter-btn"
            >
              Todos
            </button>
            <button
              [class.active]="selectedStatus === 'PENDING'"
              (click)="filterByStatus('PENDING')"
              class="filter-btn filter-pending"
            >
              Pendiente
            </button>
            <button
              [class.active]="selectedStatus === 'IN_PROCESS'"
              (click)="filterByStatus('IN_PROCESS')"
              class="filter-btn filter-in-process"
            >
              En proceso
            </button>
            <button
              [class.active]="selectedStatus === 'CLOSED'"
              (click)="filterByStatus('CLOSED')"
              class="filter-btn filter-closed"
            >
              Cerrado
            </button>
          </div>
        </div>

        <!-- Nuevo filtro por Reclamos Derivados de Otras Regionales -->
        <div class="filter-column">
          <label class="filter-label">Origen del Reclamo:</label>
          <div class="filter-buttons">
            <button
              [class.active]="selectedDerivedFilter === 'all'"
              (click)="filterByDerived('all')"
              class="filter-btn"
              title="Mostrar todos los reclamos"
            >
              Todos
            </button>
            <button
              [class.active]="selectedDerivedFilter === 'original'"
              (click)="filterByDerived('original')"
              class="filter-btn filter-original"
              title="Mostrar solo reclamos originales de esta regional"
            >
              Locales
            </button>
            <button
              [class.active]="selectedDerivedFilter === 'derived'"
              (click)="filterByDerived('derived')"
              class="filter-btn filter-derived"
              title="Mostrar solo reclamos derivados de otras regionales"
            >
              Derivados
            </button>
          </div>
        </div>

        <div class="filter-column">
          <label class="filter-label">Por Fecha:</label>
          <div class="filter-buttons">
            <button
              [class.active]="filterOption === 'all'"
              (click)="setFilterOption('all')"
              class="filter-btn"
            >
              Todos
            </button>
            <button
              [class.active]="filterOption === 'recent'"
              (click)="setFilterOption('recent')"
              class="filter-btn"
            >
              Recientes (7 días)
            </button>
            <button
              [class.active]="filterOption === 'date'"
              (click)="setFilterOption('date')"
              class="filter-btn"
            >
              Fecha Específica
            </button>
          </div>
          <input
            *ngIf="filterOption === 'date'"
            type="date"
            [value]="selectedDate"
            (change)="onDateChange($event.target.value)"
            class="date-input"
          />
        </div>
      </div>
    </div>
  </div>

  <!-- Estado de Carga -->
  <div *ngIf="loading" class="loading">
    <p>Cargando reclamos...</p>
  </div>

  <!-- Lista de Reclamos -->
  <div *ngIf="!loading" class="claims-section">
    <div *ngIf="filteredClaims.length === 0" class="empty-state">
      <mat-icon>search_off</mat-icon>
      <p>No hay reclamos que coincidan con los filtros</p>
      <button class="btn btn-primary" (click)="clearSearch()">
        Limpiar Filtros
      </button>
    </div>

    <div *ngIf="filteredClaims.length > 0" class="claims-table-wrapper">
      <table class="claims-table">
        <thead>
          <tr>
            <th>PIR</th>
            <th title="Indicador de derivación de otra regional">Derivado</th>
            <th>Tipo</th>
            <th>Pasajero</th>
            <th>Vuelo</th>
            <th>Ruta</th>
            <th>Fecha</th>
            <th>BagTag</th>
            <th>Estado</th>
          </tr>
        </thead>
        <tbody>
          <tr 
            *ngFor="let claim of paginatedClaims" 
            class="claim-row clickable-row"
            (click)="navigateToClaim(claim.id)"
          >
            <td class="cell-id">{{ claim.id }}</td>
            <td class="cell-derived">
              <span 
                *ngIf="claim.derivedFromRegional" 
                class="derived-badge"
                [title]="'Derivado de: ' + claim.derivedFromRegional"
              >
                <mat-icon>forward</mat-icon>
                {{ claim.derivedFromRegional }}
              </span>
              <span *ngIf="!claim.derivedFromRegional" class="original-badge">
                <mat-icon>home</mat-icon>
              </span>
            </td>
            <td class="cell-type">
              <!-- Badge con colores por tipo incluyendo OHL -->
              <span [class]="'badge badge-' + claim.claimType.toLowerCase()">
                {{ claim.claimType }}
              </span>
            </td>
            <td class="cell-passenger">
              {{ claim.passenger.lastName }}, {{ claim.passenger.firstName }}
            </td>
            <td class="cell-flight">{{ claim.flight }}</td>
            <td class="cell-route">{{ claim.route }}</td>
            <td class="cell-date">
              {{ claim.createdAt | date:'dd/MM/yyyy' }}
            </td>
            <td class="cell-bagtag">{{ claim.bagTag }}</td>
            <td class="cell-status">
              <!-- Status badge con nuevos estados -->
              <span [class]="'status-badge ' + getStatusClass(claim.status)">
                {{ getStatusLabel(claim.status) }}
              </span>
            </td>
          </tr>
        </tbody>
      </table>
      <mat-paginator
        [length]="filteredClaims.length"
        [pageSize]="pageSize"
        [pageSizeOptions]="pageSizeOptions"
        [pageIndex]="pageIndex"
        (page)="onPageChange($event)"
        aria-label="Select page"
      ></mat-paginator>
    </div>
  </div>

  <router-outlet />
</div>
