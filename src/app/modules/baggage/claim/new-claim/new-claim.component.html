<form class="realizar-reclamo-container" [formGroup]="pIR" (ngSubmit)="onSubmit()">

  <app-breadcrumb [items]="breadcrumbItems"></app-breadcrumb>
  <div class="form-content">
    <div class="form-group" formArrayName="route">
      <label>Rutas de Vuelo</label>
      <div *ngFor="let stop of route.controls; let i = index" class="ruta-item">
        <div [formGroupName]="i">
          
          <div class="form-field">
            <input type="text" formControlName="stop" placeholder="Ruta {{ i + 1 }}">
          </div>
          
          <button type="button" 
                  class="btn-remove"
                  (click)="eliminarRuta(i)"
                  [disabled]="route.length <= 2">
            ✕ Eliminar
          </button>
        </div>
      </div>
      <button type="button" 
          class="btn-add"
          (click)="agregarRuta()" 
          [disabled]="route.length >= 5">
        + Agregar Ruta
      </button>
    </div>
    
    <div class="form-field">
      <label>Originador</label>
      <input type="text" formControlName="originatorAirport" placeholder="Aeropuerto">
    </div>

    <div class="form-group">
      <h3>Tipo de Reclamo *</h3>
      <div class="tipo-reclamo-grid">
        <label *ngFor="let tipo of claimType" 
              class="tipo-card" 
              [class.selected]="pIR.get('claimType')?.value === tipo.valor">
          <input type="radio" 
                formControlName="claimType" 
                [value]="tipo.valor">
          <span class="tipo-label">{{ tipo.etiqueta }}</span>
        </label>
      </div>
    </div>

    <div class="section">
      <div class="form-field">
        <label>Aeropuerto</label>
        <input type="text" formControlName="airportText" placeholder="Aeropuerto" maxlength="3">
      </div>
        <div class="form-field">
        <label>Aerolinea</label>
        <input type="text" formControlName="airline" placeholder="Aerolinea" maxlength="2">
      </div>
      <div class="form-field">
        <label>Referencia</label>
        <input type="text" formControlName="reference" placeholder="Referencia" maxlength="5">
      </div>
    </div>
    
    <div class="section">
      <div class="form-field">
        <label>Apellidos del pasajero</label>
        <input type="text" formControlName="passengerLastName" placeholder="Apellidos del pasajero">
      </div>
      <div class="form-field">
        <label>Nombres del pasajero</label>
        <input type="text" formControlName="passengerName" placeholder="Nombres del pasajero">
      </div>
    </div>
    <div class="section">
      <div class="form-field">
        <label>Iniciales en el equipaje</label>
        <input type="text" formControlName="initials" placeholder="Iniciales en el equipaje" maxlength="4">
      </div>
    </div>

    <div class="section">
      <h2>Bagtags</h2>
      
      <div class="form-group" formArrayName="bagtags">
        <div *ngFor="let bagtag of bagtags.controls; let i = index" class="bagtag-item">
          <div [formGroupName]="i">
            <input type="text" 
                  formControlName="number" 
                  placeholder="Ej: ABC123456"
                  class="bagtag-input">
            
            <button type="button" 
                    class="btn-remove"
                    (click)="eliminarBagtag(i)"
                    [disabled]="bagtags.length <= 1">
              ✕ Eliminar
            </button>
          </div>
        </div>
      </div>
      
      <button type="button" 
              class="btn-add"
              (click)="agregarBagtag()"
              [disabled]="bagtags.length >= 5">
        + Agregar Bagtag
      </button>
    </div>

    <div class="section">
      <h2>Color/tipo/descripcion</h2>

      <div class="form-group" formArrayName="bagDescription">
        <div *ngFor="let description of bagDescription.controls; let i = index" class="bagtag-item">
          <div [formGroupName]="i">
            <input type="text"
                  formControlName="description" 
                  placeholder="Ej: WT01DBC"
                  maxlength="7"
                  class="bagtag-input">
            <button type="button" class="btn-add" (click)="indiceActual = i; modalIdentificacionAbierto = true">
              Llenar por interfaz
            </button>
            
            <button type="button" 
                    class="btn-remove"
                    (click)="eliminarBagDescription(i)"
                    [disabled]="bagDescription.length <= 1">
              ✕ Eliminar
            </button>
          </div>
        </div>
      </div>

            <!-- Modal de identificacion de equipaje -->
      <div class="modal-overlay" *ngIf="modalIdentificacionAbierto" (click)="modalIdentificacionAbierto = false">
        <div class="modal-content" (click)="$event.stopPropagation()">
          
          <div class="modal-header">
            <h2>Identificación de Equipaje</h2>
            <button class="btn-close" (click)="modalIdentificacionAbierto = false">✕</button>
          </div>
          
          <div class="modal-body">
            <div class="form-field">
              <label>Color</label>
              <select [(ngModel)]="color" [ngModelOptions]="{standalone: true}">
                <option value="">Seleccionar...</option>
                <option *ngFor="let color of colors" [value]="color.value">
                  {{ color.description }}
                </option>
              </select>
            </div>

            <div class="form-field">
              <label>Tipo</label>
              <select [(ngModel)]="type" [ngModelOptions]="{standalone: true}">
                <option value="">Seleccionar...</option>
                <option *ngFor="let type of types" [value]="type.value">
                  {{ type.description }}
                </option>
              </select>
            </div>

            <div class="form-field">
              <label>Material</label>
              <select [(ngModel)]="material" [ngModelOptions]="{standalone: true}">
                <option value="">Seleccionar...</option>
                <option *ngFor="let material of materials" [value]="material.value">
                  {{ material.description }}
                </option>
              </select>
            </div>

            <div class="form-field">
              <label>Elementos basicos</label>
              <select [(ngModel)]="basicElement" [ngModelOptions]="{standalone: true}">
                <option value="">Seleccionar...</option>
                <option *ngFor="let basicElement of basicElements" [value]="basicElement.value">
                  {{ basicElement.description }}
                </option>
              </select>
            </div>

            <div class="form-field">
              <label>Elementos externos</label>
              <select [(ngModel)]="externalElement" [ngModelOptions]="{standalone: true}">
                <option value="">Seleccionar...</option>
                <option *ngFor="let externalElement of externalElements" [value]="externalElement.value">
                  {{ externalElement.description }}
                </option>
              </select>
            </div>

            <div class="preview-box" *ngIf="type && color && material && basicElement && externalElement">
              <strong>{{ color + type + material + basicElement + externalElement }}</strong>
            </div>

          </div>
          
          <div class="modal-footer">
            <button class="btn btn-secondary" (click)="modalIdentificacionAbierto = false">
              Cancelar
            </button>
            <button class="btn btn-primary" 
                    (click)="aplicarCodigo()"
                    [disabled]="!type || !color || !material || !basicElement || !externalElement">
              Aplicar
            </button>
          </div>
          
        </div>
      </div>
      
      <button type="button" 
              class="btn-add"
              (click)="agregarBagDescription()"
              [disabled]="bagDescription.length >= 5">
        + Agregar descripcion de maleta
      </button>
    </div>

    <div class="form-group" formArrayName="traceRoute">
        <h2>Ruta a rastrear</h2>
      <div *ngFor="let stop of traceRoute.controls; let i = index" class="ruta-item">
        <div [formGroupName]="i">
          
          <div class="form-field">
            <input type="text" formControlName="traceRouteStop" placeholder="Ruta {{ i + 1 }}">
          </div>
          
          <button type="button" 
                  class="btn-remove"
                  (click)="eliminarRutaARastrear(i)"
                  [disabled]="traceRoute.length <= 1">
            ✕ Eliminar
          </button>

        </div>
      </div>
      <button type="button" 
          class="btn-add"
          (click)="agregarRutaARastrear()" 
          [disabled]="traceRoute.length >= 5">
        + Agregar Ruta a Rastrear
      </button>
    </div>

    <div class="form-group" formArrayName="flightNumber">
        <h2>Numero de vuelo</h2>
      <div *ngFor="let flight of flightNumber.controls; let i = index" class="ruta-item">
        <div [formGroupName]="i">
          
          <div class="form-field">
            <input type="text" formControlName="flightNo" placeholder="Numero de vuelo {{ i + 1 }}">
          </div>

          <div class="form-field">
            <input
              type="datetime-local"
              formControlName="flightDate"
              placeholder="Fecha y hora de vuelo {{ i + 1 }}">
          </div>
          
          <button type="button" 
                  class="btn-remove"
                  (click)="eliminarVuelo(i)"
                  [disabled]="flightNumber.length <= 1">
            ✕ Eliminar
          </button>
        </div>

      </div>
      <button type="button" 
          class="btn-add"
          (click)="agregarVuelo()" 
          [disabled]="flightNumber.length >= 5">
        + Agregar Vuelo
      </button>
    </div>

    <div class="form-group" formArrayName="bagIdentification">
      <h2>Marca en la maleta</h2>
      <div *ngFor="let identification of bagIdentification.controls; let i = index" class="ruta-item">
        <div [formGroupName]="i">
          
          <div class="form-field">
            <input type="text" formControlName="mark" placeholder="Marca {{ i + 1 }}">
          </div>
          
          <button type="button" 
                  class="btn-remove"
                  (click)="eliminarIdentificacion(i)"
                  [disabled]="bagIdentification.length <= 1">
            ✕ Eliminar
          </button>
        </div>

      </div>
      <button type="button" 
          class="btn-add"
          (click)="agregarIdentificacion()" 
          [disabled]="bagIdentification.length >= 5">
        + Agregar Identificación
      </button>
    </div>

    <div class="form-group" formArrayName="contents">
      <h2>Contenido</h2>
      <div *ngFor="let description of contents.controls; let i = index" class="ruta-item">
        <div [formGroupName]="i">
          
          <div class="form-field">
            <input type="text" formControlName="description" placeholder="Contenido {{ i + 1 }}">
          </div>
          
          <button type="button" 
                  class="btn-remove"
                  (click)="eliminarContenido(i)"
                  [disabled]="contents.length <= 1">
            ✕ Eliminar
          </button>
        </div>

      </div>
      <button type="button" 
          class="btn-add"
          (click)="agregarContenido()" 
          [disabled]="contents.length >= 5">
        + Agregar Contenido
      </button>
    </div>

    <div class="section">
      <div class="form-field">
        <label>Direccion Permanente</label>
        <input type="text" formControlName="permanentAddress" placeholder="Direccion Permanente">
      </div>
    </div>

    <div class="section">
      <div class="form-field">
        <label>Direccion Temporal</label>
        <input type="text" formControlName="temporaryAddress" placeholder="Direccion Temporal">
      </div>
    </div>

    <div class="section">
      <div class="form-field">
        <label>Correo electrónico</label>
        <input type="email" formControlName="email" placeholder="Email">
      </div>
    </div>

    <div class="section">
      <div class="form-field">
        <label>Telefono Permanente</label>
        <input type="text" formControlName="permanentPhone" placeholder="Telefono Permanente">
      </div>
    </div>

    <div class="section">
      <div class="form-field">
        <label>Telefono Temporal</label>
        <input type="text" formControlName="temporaryPhone" placeholder="Telefono Temporal">
      </div>
    </div>

    <div class="section">
      <div class="form-field">
        <label>Instrucciones de entrega</label>
        <input type="text" formControlName="deliveryInstructions" placeholder="Instrucciones de entrega">
      </div>
    </div>

    <div class="section">
      <div class="form-field">
        <label>Informacion adicional</label>
        <input type="text" formControlName="additionalInfo" placeholder="Informacion adicional">
      </div>
    </div>

    <div class="section">
      <div class="form-field">
        <label>Peso del Equipaje Facturado</label>
        <input type="number" formControlName="checkedBaggageWeight" placeholder="Peso del Equipaje Facturado">
      </div>
    </div>

    <div class="section">
      <div class="form-field">
        <label>Peso del Equipaje Entregado</label>
        <input type="number" formControlName="deliveredBaggageWeight" placeholder="Peso del Equipaje Entregado">
      </div>
    </div>

    <div class="form-field">
      <label>Diferencia de Peso (kg)</label>
      <input type="number" 
            formControlName="weightDifference" 
            placeholder="Se calcula automáticamente"
            readonly
            class="readonly-field">
    </div>

    <div class="section">
      <div class="form-field">
        <label>Idioma</label>
        <input type="text" formControlName="language" placeholder="Idioma" maxlength="10">
      </div>
    </div>

    <div class="section">
      <div class="form-field">
        <label>Numero de Pasaporte</label>
        <input type="text" formControlName="passportNumber" placeholder="Numero de Pasaporte">
      </div>
    </div>

    <div class="section">
      <div class="form-field">
        <label>Numero de Ticket</label>
        <input type="text" formControlName="ticketNumber" placeholder="Numero de Ticket">
      </div>
    </div>

    <div class="section">
      <div class="form-field">
        <label>PNR</label>
        <input type="text" formControlName="pnr" placeholder="PNR">
      </div>
    </div>

    <div class="section">
      <div class="form-field">
        <label>frequent flyer id</label>
        <input type="text" formControlName="frequentFlyerId" placeholder="frequent flyer id">
      </div>
    </div>

    <div class="section">
      <div class="form-field">
        <label>Razon de Perdida</label>
        <input type="text" formControlName="lossReason" placeholder="Razon de Perdida">
      </div>
    </div>

    <div class="section">
      <div class="form-field">
        <label>Estacion de Fallo</label>
        <input type="text" formControlName="faultStation" placeholder="Estacion de Fallo">
      </div>
    </div>

    <div class="form-group">
      <h3>¿Tiene seguro? *</h3>

      <div class="tipo-reclamo-grid">
        <label class="tipo-card" 
              [class.selected]="pIR.get('hasInsurance')?.value === true">
          <input type="radio" 
                formControlName="hasInsurance" 
                [value]="true">
          <span class="tipo-label">Sí</span>
        </label>
        
        <label class="tipo-card" 
              [class.selected]="pIR.get('hasInsurance')?.value === false">
          <input type="radio" 
                formControlName="hasInsurance" 
                [value]="false">
          <span class="tipo-label">No</span>
        </label>
      </div>
      <button type="button" 
              class="btn-remove" 
              (click)="clearInsurance()"
              *ngIf="pIR.get('hasInsurance')?.value !== null">
        ✕ Limpiar
      </button>
    </div>

    <div class="form-group">
      <h3>¿Maletas cerradas necesitan llave? *</h3>
      
      <div class="tipo-reclamo-grid">
        <label class="tipo-card" 
              [class.selected]="pIR.get('keysAttached')?.value === true">
          <input type="radio" 
                formControlName="keysAttached" 
                [value]="true">
          <span class="tipo-label">Sí</span>
        </label>
        
        <label class="tipo-card" 
              [class.selected]="pIR.get('keysAttached')?.value === false">
          <input type="radio" 
                formControlName="keysAttached" 
                [value]="false">
          <span class="tipo-label">No</span>
        </label>
      </div>
      <button type="button" 
              class="btn-remove" 
              (click)="clearKeysAttached()"
              *ngIf="pIR.get('keysAttached')?.value !== null">
        ✕ Limpiar
      </button>
    </div>

    <div class="section">
      <div class="form-field">
        <label>Combinacion de Cerradura</label>
        <input type="text" formControlName="lockCombination" placeholder="Combinacion de Cerradura">
      </div>
    </div>

    <div class="form-group">
      <h3>Kit de noche hombre o mujer *</h3>
      
      <div class="tipo-reclamo-grid">
        <label class="tipo-card" 
              [class.selected]="pIR.get('nightKit')?.value === true">
          <input type="radio" 
                formControlName="nightKit" 
                [value]="true">
          <span class="tipo-label">Hombre</span>
        </label>
        
        <label class="tipo-card" 
              [class.selected]="pIR.get('nightKit')?.value === false">
          <input type="radio" 
                formControlName="nightKit" 
                [value]="false">
          <span class="tipo-label">Mujer</span>
        </label>
      </div>
      <button type="button" 
              class="btn-remove" 
              (click)="pIR.get('nightKit')?.setValue(null)"
              *ngIf="pIR.get('nightKit')?.value !== null">
        ✕ Limpiar
      </button>
    </div>

    <div class="form-group">
      <h3>Tipo de Daño *</h3>
      <div class="tipo-reclamo-grid">
        <label *ngFor="let tipo of damageType" 
              class="tipo-card" 
              [class.selected]="pIR.get('damageType')?.value === tipo.valor">
          <input type="radio" 
                formControlName="damageType" 
                [value]="tipo.valor">
          <span class="tipo-label">{{ tipo.etiqueta }}</span>
        </label>
      </div>
      <button type="button" 
              class="btn-remove" 
              (click)="pIR.get('damageType')?.setValue(null)"
              *ngIf="pIR.get('damageType')?.value !== null">
        ✕ Limpiar
      </button>
    </div>

    <div class="form-group">
      <h3>Condicion del equipaje *</h3>
      <div class="tipo-reclamo-grid">
        <label *ngFor="let condicion of condition" 
              class="tipo-card" 
              [class.selected]="pIR.get('condition')?.value === condicion.valor">
          <input type="radio" 
                formControlName="condition" 
                [value]="condicion.valor">
          <span class="tipo-label">{{ condicion.etiqueta }}</span>
        </label>
      </div>
      <button type="button" 
              class="btn-remove" 
              (click)="clearCondition()"
              *ngIf="pIR.get('condition')?.value !== null">
        ✕ Limpiar
      </button>
    </div>

    <div class="form-group">
      <h3>Ubicación del Daño</h3>
      <p>Seleccione todas las ubicaciones con daño:</p>
      
      <div class="tipo-reclamo-grid">
        <label *ngFor="let location of damageLocations" 
              class="tipo-card"
              [class.selected]="isUbicacionSelected(location.valor)">
          <input type="checkbox"
                [checked]="isUbicacionSelected(location.valor)"
                (change)="onUbicacionChange($event, location.valor)">
          <span class="tipo-label">{{ location.etiqueta }}</span>
        </label>
      </div>

      <div *ngIf="damageLocationsArray.length === 0" class="sin-seleccion">
        No se han seleccionado ubicaciones
      </div>
    </div>

    <div class="section">
      <button type="submit" 
              class="btn-submit"
              [disabled]="pIR.invalid">
        Enviar
      </button>
    </div>
  </div>
</form>

