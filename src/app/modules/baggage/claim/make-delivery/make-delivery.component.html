<div class="make-delivery-container">

  <!-- ================= FORM ================= -->

  <div class="delivery-form-section" *ngIf="!showConfirmation">

    <div class="form-header">
      <h1>Realizar Entrega</h1>
      <p class="subtitle">PIR #{{ pirNumber }}</p>
    </div>

    <form [formGroup]="deliveryForm" class="delivery-form">

      <!-- ================= TIPO ENTREGA ================= -->

      <div class="form-section">
        <h2 class="section-title">Tipo de Entrega</h2>

        <div class="delivery-type-cards">
          <div
            *ngFor="let type of deliveryTypes"
            class="delivery-type-card"
            [class.selected]="selectedDeliveryType === type.value"
            (click)="deliveryForm.get('tipo')?.setValue(type.value)"
          >
            <mat-icon>{{ type.icon }}</mat-icon>
            <span>{{ type.label }}</span>
          </div>
        </div>
      </div>

      <!-- ================= DOMICILIO ================= -->

      <div class="form-section" *ngIf="selectedDeliveryType === 'domicilio'">

        <h2 class="section-title">Datos de Envío</h2>

        <!-- Selector dirección -->

        <mat-radio-group
          class="radio-group"
          value="temporal"
          (change)="onAddressTypeChange($event.value)"
        >

          <mat-radio-button value="temporal">
            Dirección Temporal
          </mat-radio-button>

          <mat-radio-button value="permanente">
            Dirección Permanente
          </mat-radio-button>

        </mat-radio-group>

        <!-- Dirección -->

        <div class="form-group">
          <label class="form-label">Dirección *</label>

          <textarea
            class="form-textarea"
            rows="3"
            formControlName="direccion"
            [class.error]="isFieldRequired('direccion')"
          ></textarea>

          <span class="error-message" *ngIf="isFieldRequired('direccion')">
            La dirección es requerida
          </span>
        </div>

        <!-- Teléfono -->

        <div class="form-group">
          <label class="form-label">Teléfono *</label>

          <input
            class="form-input"
            type="text"
            formControlName="telefono"
            [class.error]="isFieldRequired('telefono')"
          />

          <span class="error-message" *ngIf="isFieldRequired('telefono')">
            El teléfono es requerido
          </span>
        </div>

        <!-- Referencia -->

        <div class="form-group">
          <label class="form-label">Referencia</label>

          <input
            class="form-input"
            type="text"
            formControlName="referencia"
          />
        </div>

        <div class="info-box warning">
          <mat-icon>local_shipping</mat-icon>
          <p>
            El envío a domicilio genera costos de transporte que serán registrados como gasto del reclamo.
          </p>
        </div>

      </div>

      <!-- ================= AEROPUERTO ================= -->

      <div class="form-section" *ngIf="selectedDeliveryType === 'aeropuerto'">

        <h2 class="section-title">Seleccionar Aeropuerto</h2>

        <div class="aeropuerto-grid">
          <div
            *ngFor="let aeropuerto of aeropuertos"
            class="aeropuerto-card"
            [class.selected]="deliveryForm.get('aeropuerto')?.value === aeropuerto.codigo"
            (click)="deliveryForm.get('aeropuerto')?.setValue(aeropuerto.codigo)"
          >
            <div class="aeropuerto-codigo">{{ aeropuerto.codigo }}</div>

            <div class="aeropuerto-info">
              <span class="aeropuerto-ciudad">{{ aeropuerto.ciudad }}</span>
              <span class="aeropuerto-nombre">{{ aeropuerto.nombre }}</span>
            </div>
          </div>
        </div>

        <span class="error-message" *ngIf="isFieldRequired('aeropuerto')">
          Debe seleccionar un aeropuerto
        </span>

        <div class="info-box">
          <mat-icon>info</mat-icon>
          <p>
            El pasajero deberá presentar su documento de identidad y el comprobante de reclamo.
          </p>
        </div>

      </div>

      <!-- ================= BOTONES ================= -->

      <div class="form-actions">

        <button type="button" class="btn btn-cancel" (click)="cancelar()">
          <mat-icon>close</mat-icon>
          Cancelar
        </button>

        <button
          type="button"
          class="btn btn-accept"
          (click)="aceptar()"
          [disabled]="deliveryForm.invalid"
        >
          <mat-icon>check</mat-icon>
          Continuar
        </button>

      </div>

    </form>

  </div>

  <!-- ================= CONFIRMACION ================= -->

  <div class="confirmation-section" *ngIf="showConfirmation && confirmationData">

    <div class="confirmation-header">
      <h1>Confirmar Entrega</h1>
      <p class="subtitle">Revise los datos</p>
    </div>

    <div class="confirmation-box">

      <div class="confirmation-item">
        <span class="label">Tipo:</span>
        <span class="value highlight">{{ confirmationData.tipo }}</span>
      </div>

      <ng-container *ngIf="confirmationData.direccion">

        <div class="confirmation-item">
          <span class="label">Dirección:</span>
          <span class="value">{{ confirmationData.direccion }}</span>
        </div>

        <div class="confirmation-item">
          <span class="label">Teléfono:</span>
          <span class="value">{{ confirmationData.telefono }}</span>
        </div>

      </ng-container>

      <ng-container *ngIf="confirmationData.aeropuerto">

        <div class="confirmation-item">
          <span class="label">Aeropuerto:</span>
          <span class="value">
            {{ confirmationData.aeropuerto }} - {{ confirmationData.nombreAeropuerto }}
          </span>
        </div>

      </ng-container>

    </div>

    <div class="confirmation-actions">

      <button class="btn btn-cancel" (click)="volver()">
        <mat-icon>arrow_back</mat-icon>
        Volver
      </button>

      <button class="btn btn-confirm" (click)="confirmarEntrega()">
        <mat-icon>done_all</mat-icon>
        Confirmar
      </button>

    </div>

  </div>

</div>
